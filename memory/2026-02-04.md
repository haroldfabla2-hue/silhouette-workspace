# 2026-02-04 - Configuraci√≥n de Seguridad e Infraestructura

## Servidor
- **IP:** 208.117.86.132
- **Hostname:** Silhouetteserver
- **OS:** Ubuntu 24.04 LTS
- **Tailscale IP:** 100.126.126.48

## DNS
- `sil.albertofarah.com` ‚Üí 208.117.86.132 ‚úì
- `ui.sil.albertofarah.com` ‚Üí (pendiente, usar path /openclaw por ahora)
- **Tailscale DNS:** silhouetteserver.tail77b896.ts.net ‚Üí 100.126.126.48

---

## Instalado y Configurado

### Docker
- **Versi√≥n:** 29.2.1
- **Docker Compose:** v5.0.2
- **Red Docker:** `sil-network` (para aislamiento de proyectos)
- **Configuraci√≥n:** /etc/docker/daemon.json
  - Storage: overlay2
  - Logging: json-file (max 10MB, 3 archivos)
  - ICC: deshabilitado

### Caddy
- **Versi√≥n:** 2.10.2
- **Email ACME:** alberto.farah.b@gmail.com
- **UI Access:** https://sil.albertofarah.com/openclaw
- **Headers de seguridad:** HSTS, CSP, X-Frame-Options, etc.
- **Puerto:** 443

### Firewall (UFW)
- **Estado:** Enabled
- **Pol√≠tica:** Deny incoming, Allow outgoing
- **Puertos abiertos:** 22 (SSH), 80 (HTTP), 443 (HTTPS)

### SSH Hardening
- **Archivo:** /etc/ssh/sshd_config.d/hardening.conf
- **PermitRootLogin:** no
- **PasswordAuthentication:** no
- **PubkeyAuthentication:** yes
- **ClientAliveInterval:** 300s
- **MaxAuthTries:** 3

### Tailscale
- **Versi√≥n:** 1.94.1
- **Auth Key:** TpHejYAp8N11CNTRL (configurado)
- **Dispositivos conectados:** 3 (server + laptop + iPhone)
- **Serve:** Puerto 8443 (para evitar conflicto con Caddy 443)

---

## APIs Configuradas (Seguras)

### Archivo Principal
- **Ubicaci√≥n:** /root/.openclaw/workspace/.env
- **Template:** /root/.openclaw/workspace/.env.template

| API | Variable | Estado |
|-----|----------|--------|
| Brave Search | BRAVE_API_KEY | Configurada |
| Notion | NOTION_API_KEY | Configurada |
| GitHub | GITHUB_TOKEN | Configurada |

### OpenClaw Auth Profiles
- **Ubicaci√≥n:** /root/.openclaw/agents/main/agent/auth-profiles.json
- **Notas:** Mapeo de variables de entorno configurado

---

## Gateway OpenClaw

### Configuraci√≥n Actual
```json
{
  "gateway": {
    "port": 18789,
    "mode": "local",
    "bind": "loopback",
    "auth": {
      "mode": "token",
      "token": "CJCCZP9xYVF0DNF+lT6KmXOXLvlAmDj33boiKZipZoo=",
      "allowTailscale": true
    },
    "controlUi": {
      "enabled": true,
      "basePath": "/openclaw"
    },
    "tailscale": {
      "mode": "serve",
      "resetOnExit": false
    }
  }
}
```

### URLs de Acceso

| M√©todo | URL | Puerto | Estado |
|--------|-----|--------|--------|
| **Tailscale Serve (RECOMENDADO)** | https://silhouetteserver.tail77b896.ts.net:8443/openclaw/ | 8443 | ‚úÖ Funcionando |
| Caddy (proyectos) | https://sil.albertofarah.com/openclaw | 443 | ‚ö†Ô∏è Gateway en loopback, no accesible |

### Token de Acceso
- **Token:** `CJCCZP9xYVF0DNF+lT6KmXOXLvlAmDj33boiKZipZoo=`
- **Ubicaci√≥n:** `~/.openclaw/openclaw.json`

### Dispositivos Emparejados
- **Laptop (laptop-j5hbefd2):** Aprobado (2026-02-04 21:32)
- **iPhone (iphone-11):** Conectado
- **Servidor (silhouetteserver):** Activo

---

## Errores y Soluciones

### Error 1: Gateway connection 1006

**Problema:** Error "disconnected (1006): no reason" al acceder a la UI.

**Causa:** Caddy no ten√≠a soporte para WebSocket.

**Soluci√≥n:**
```caddyfile
reverse_proxy 127.0.0.1:18789 {
    header_up Connection "upgrade"
    header_up Upgrade "websocket"
}
```

### Error 2: Not Found en Tailscale Serve

**Problema:** Tailscale Serve devolv√≠a 404.

**Causa:** Conflicto de puertos - Caddy ocupaba el puerto 443.

**Soluci√≥n:** Configurar Tailscale Serve en puerto 8443:
```bash
tailscale serve --bg --https=8443 127.0.0.1:18789
```

### Error 3: Pairing Required

**Problema:** UI ped√≠a "pairing required".

**Causa:** Primera conexi√≥n desde nuevo dispositivo requiere aprobaci√≥n.

**Soluci√≥n:**
```bash
openclaw devices list
openclaw devices approve <requestId>
```

---

## üñ•Ô∏è Chrome Profile (Sil)

### Profile Location
```
~/.config/chromium-profiles/sil/
```

### Commands
```bash
# Launch my profile
chromium-browser --user-data-dir=/root/.config/chromium-profiles/sil
```

### Browser Relay (Remote Control)
- **Profile:** chrome
- **Attach:** Click OpenClaw Browser Relay toolbar icon on the tab
- **Use:** `browser` tool with `profile="chrome"`

---

## üåê Google Workspace Integration

### Reglas de Seguridad
‚ö†Ô∏è **Nunca:**
- Acceder al Gmail personal de Alberto sin permiso expl√≠cito
- Hacer compras sin permiso expl√≠cito + confirmado
- Compartir informaci√≥n privada de Alberto
- Almacenar credenciales personales en este perfil

‚ö†Ô∏è **Siempre:**
- Preguntar antes de acceder a cuentas personales
- Usar browser relay para tareas personales
- Documentar accesos a recursos compartidos
- Registrar acciones que modifiquen datos compartidos

### Herramientas Disponibles
| Herramienta | URL | Uso |
|-------------|-----|-----|
| Gmail | https://gmail.com | Leer/enviar emails (con permiso) |
| Google Drive | https://drive.google.com | Compartir/gestionar archivos |
| Google Docs | https://docs.google.com | Documentos colaborativos |
| Google Sheets | https://sheets.google.com | Hojas de c√°lculo |
| Google Calendar | https://calendar.google.com | Eventos |
| Google Keep | https://keep.google.com | Notas |

### APIs Configuradas
| API | Variable | Estado |
|-----|----------|--------|
| Brave Search | BRAVE_API_KEY | ‚úÖ |
| Notion | NOTION_API_KEY | ‚úÖ |
| GitHub | GITHUB_TOKEN | ‚úÖ |
| **Google Workspace** | **gogcli** | ‚úÖ **Configurado** |

---

## üîß Google Workspace (gogcli)

### Instalado
- **Versi√≥n:** v0.9.0
- **Binario:** /usr/local/bin/gog
- **Config:** ~/.config/gogcli/

### APIs Habilitadas
- Gmail API ‚úÖ
- Calendar API ‚úÖ
- Drive API ‚úÖ
- Docs API ‚úÖ
- Sheets API ‚úÖ
- Slides API ‚úÖ (v√≠a Drive)
- Tasks API ‚úÖ
- Contacts API ‚úÖ

### Configuraci√≥n
```bash
# Variable de entorno
export GOG_ACCOUNT="alberto.farah.b@gmail.com"
export GOG_KEYRING_PASSWORD="mi-password-secreto"
```

### Comandos √ötiles

**Gmail:**
```bash
gog gmail labels list
gog gmail search 'newer_than:7d --max 10'
gog gmail send --to a@b.com --subject "Hi" --body "Hello"
```

**Calendar:**
```bash
gog calendar events --today
gog calendar events --week
gog calendar search "meeting" --from 2025-01-01 --to 2025-01-31
```

**Drive:**
```bash
gog drive ls
gog drive search "query"
gog drive upload ./file.txt --name "File"
```

**Sheets:**
```bash
gog sheets get <sheetId> "Tab!A1:D10" --json
gog sheets update <sheetId> "Tab!A1" --values-json '[["A","B"]]'
gog sheets append <sheetId> "Tab!A:C" --values-json '[["x","y"]]'
```

**Docs:**
```bash
gog docs cat <docId>
gog docs export <docId> --format txt --out /tmp/doc.txt
```

**Tasks:**
```bash
gog tasks list <tasklistId>
```

**Contacts:**
```bash
gog contacts list --max 20
```

### Slides
Slides no tiene comando nativo, se accede via Drive:
```bash
# Buscar slides
gog drive search "mimeType='application/vnd.google-apps.presentation'"

# Exportar como PDF
gog drive export <slideId> --format pdf --out /tmp/slides.pdf
```

---

## Reglas de Seguridad Aplicadas

1. ‚úÖ Firewall UFW habilitado
2. ‚úÖ SSH hardening (no root login, no password auth)
3. ‚úÖ Clave SSH Ed25519 creada
4. ‚úÖ APIs en archivo seguro (.env)
5. ‚úÖ Docker daemon configurado con opciones seguras
6. ‚úÖ Caddy con headers de seguridad
7. ‚úÖ Red Docker aislada para proyectos
8. ‚úÖ Gateway en loopback (solo localhost)
9. ‚úÖ Tailscale Serve con autenticaci√≥n habilitada

---

## üé§ Voice (STT + TTS) - ACTUALIZADO 2026-02-05

### Sistema de Voz Completo

| Componente | Estado | Descripci√≥n |
|------------|--------|-------------|
| **STT (Speech-to-Text)** | ‚úÖ faster-whisper | Transcripci√≥n local, multiling√ºe |
| **TTS (Text-to-Speech)** | ‚úÖ Google Cloud TTS | Voces naturales en espa√±ol |

### faster-whisper (STT)
- **Instalado:** ‚úÖ
- **Modelo:** base (CPU, int8)
- **Ubicaci√≥n:** Python package (pip)
- **Idiomas:** 100+ incluyendo espa√±ol
- **Uso:** `python3 -m faster_whisper audio.wav`

### Google Cloud TTS
- **Instalado:** ‚úÖ
- **Voces:** es-ES-Neural2-A (femenina natural)
- **Gratis:** 4M caracteres/mes
- **Script:** `~/.openclaw/tools/google-tts.py`
- **Voz por defecto:** es-ES-Neural2-A

#### Uso de TTS
```bash
# Generar audio
~/.openclaw/tools/google-tts.py "Hola mundo" --voice es-ES-Neural2-A

# Listar voces disponibles
~/.openclaw/tools/google-tts.py voices
```

---

## üåê Google OAuth Completo - 2026-02-05

### Sistema de Tokens Unificado

**Ubicaci√≥n:** `~/.openclaw/google-oauth/`
- **Credenciales:** `~/.openclaw/google-oauth/credentials/google-oauth.json`
- **Tokens:** `~/.openclaw/google-oauth/tokens/tokens.json`
- **Gestor:** `~/.openclaw/tools/google-oauth.py`

### Scopes Autorizados (13/13)

| Servicio | Scope | Funcionalidades |
|----------|-------|-----------------|
| **Gmail** | `gmail.readonly` | Leer correos |
| | `gmail.send` | ‚úÖ Enviar correos |
| | `gmail.modify` | ‚úÖ Organizar, etiquetar |
| | `gmail.compose` | ‚úÖ Crear borradores |
| **Calendar** | `calendar` | ‚úÖ Crear/modificar/eliminar eventos, invitar |
| **Drive** | `drive` | ‚úÖ Gestionar archivos |
| **Docs** | `documents` | ‚úÖ Editar documentos |
| **Sheets** | `spreadsheets` | ‚úÖ Editar hojas de c√°lculo |
| **Tasks** | `tasks` | ‚úÖ Gestionar tareas |
| **Contacts** | `contacts.readonly` | ‚úÖ Leer contactos |
| | `contacts` | ‚úÖ Agregar/editar contactos |
| **Meet** | `meetings.space.created` | ‚úÖ Crear reuniones |
| **Cloud TTS** | `cloud-platform` | ‚úÖ Voces naturales |

### Scripts Disponibles

| Script | Uso |
|--------|-----|
| `~/.openclaw/tools/google-oauth.py status` | Ver estado de tokens |
| `~/.openclaw/tools/google-oauth.py refresh` | Renovar tokens |
| `~/.openclaw/tools/google-gmail.py list` | Listar correos |
| `~/.openclaw/tools/google-gmail.py send "to" "subject" "body"` | Enviar correo |
| `~/.openclaw/tools/google-calendar.py events` | Ver eventos |
| `~/.openclaw/tools/google-calendar.py create "title" "desc"` | Crear evento |
| `~/.openclaw/tools/google-contacts.py list` | Listar contactos |
| `~/.openclaw/tools/google-contacts.py add "Name" email phone` | Agregar contacto |
| `~/.openclaw/tools/google-meet.py create "title" "desc"` | Crear reuni√≥n |
| `~/.openclaw/tools/google-tts.py "texto"` | Generar voz |

### Token Status
- **Cuenta:** alberto.farah.b@gmail.com
- **Expiry:** Renovado autom√°ticamente cada ~1 hora
- **Refresh Token:** Guardado en tokens.json

---

## üîß Scripts Personalizados Creados

### ~/.openclaw/tools/
- `google-oauth.py` - Gestor de tokens OAuth
- `google-gmail.py` - Gesti√≥n Gmail
- `google-calendar.py` - Gesti√≥n Calendar
- `google-contacts.py` - Gesti√≥n Contacts
- `google-meet.py` - Gesti√≥n Meet
- `google-tts.py` - Text to Speech
- `oauth-exchange.py` - Intercambio c√≥digo por tokens

---

## üìã Configuraci√≥n gogcli (anterior)

**Nota:** gogcli a√∫n tiene tokens antiguos. Los nuevos scripts usan `~/.openclaw/google-oauth/` directamente.

---

## Pr√≥ximos Pasos

1. [ ] Probar UI desde laptop (ya funcionando)
2. [ ] Configurar DNS para ui.sil.albertofarah.com (opcional)
3. [ ] Crear primer proyecto Docker de prueba
4. [ ] Configurar backup autom√°tico
5. [ ] Configurar monitoring

---

## Notas de Seguridad

‚ö†Ô∏è **Importante:**
- Nunca commitar `.env` a git
- Usar siempre claves SSH para acceso
- Revisar logs regularmente: `journalctl -u ssh`
- Mantener sistema actualizado: `apt update && apt upgrade`
- Gateway debe quedarse en loopback para seguridad
- Acceso remoto por Tailscale Serve (puerto 8443)
- Device pairing requerido para nuevos dispositivos

---

## Comandos √ötiles

```bash
# Estado de Tailscale
tailscale status

# Estado del serve
tailscale serve status

# Reiniciar serve
tailscale serve reset
tailscale serve --bg --https=8443 127.0.0.1:18789

# Ver dispositivos
openclaw devices list

# Aprobar dispositivo
openclaw devices approve <requestId>

# Ver gateway
ps aux | grep openclaw-gateway

# Logs del gateway
tail -f /tmp/openclaw/openclaw-2026-02-04.log
```

---

## üîç Investigaci√≥n OpenClaw - Casos Avanzados (2026-02-05)

### Voces TTS - Descubrimiento Importante
- **Google Cloud TTS NO tiene acento peruano** - Solo espa√±ol de Espa√±a (es-ES)
- **Voces m√°s naturales disponibles:**
  - `es-ES-Chirp3-HD-Aoede` (femenina) - La m√°s natural
  - `es-ES-Neural2-A` (femenina) - Cl√°sica y muy natural
- **Alternativas para acento peruano:**
  - ElevenLabs ($5-11/mes) - ‚≠ê Recomendado
  - Azure TTS - Tiene espa√±ol Latam (5h gratis/mes)

### Casos de Uso Avanzados de la Comunidad
| Categor√≠a | Proyecto | Descripci√≥n |
|-----------|----------|-------------|
| **Automatizaci√≥n** | Tesco Shop Autopilot | Compra semanal autom√°tica (solo navegador) |
| | ParentPay Meals | Reserva comidas escolares UK |
| | Wine Cellar Skill | Gesti√≥n de bodega desde CSV |
| **Voz/Llamadas** | Voice Wake | Siempre escuchando |
| | Phone Integration | Llamadas reales (Twilio) |
| **Multi-Agente** | Dream Team (14+ agentes) | Orquestaci√≥n con Opus 4.5 |
| **Hardware** | Bambu 3D Printer | Control impresi√≥n 3D |
| | Oura Health | Integraci√≥n salud + calendar |
| | Vienna Transport | Transporte p√∫blico tiempo real |

### Ideas para Automatizaciones Proactivas (Sil)
1. üìÖ Recordatorios de calendar (30 min antes)
2. üìß Resumen matutino de emails (8am)
3. üå§Ô∏è Alertas de clima (si llueve)
4. üìä Health check del servidor (docker, servicios)
5. üîÑ ClawHub auto-sync

---

## üîç Investigaci√≥n Completa de Alberto (2026-02-05)

### Archivos Creados
| Archivo | Ubicaci√≥n |
|---------|-----------|
| **Perfil completo** | `/root/.openclaw/workspace/research/alberto-investigation-2026-02-05.md` |
| **Protocolo Anti-Alucinaciones** | Drive: "Pt titil√≥ de mitigaci√≥n de alucinaciones" |
| **USER.md actualizado** | `/root/.openclaw/workspace/USER.md` |
| **MEMORY.md actualizado** | `/root/.openclaw/workspace/MEMORY.md` |

### Informaci√≥n Clave Descubierta

#### Perfil de Alberto (Beto)
- **Nombre:** Alberto Harold Farah Blair (27 a√±os, 19/10/1997)
- **Rol:** Cofundador y Director de Estrategia y Sistemas @ Brandistry
- **Misi√≥n:** "Construyo sistemas bellos que expanden la agencia humana"
- **Experiencia:** 5+ a√±os, 20+ proyectos, 98% satisfacci√≥n

#### Proyectos Actuales (Modelo 1-3-1)
| Proyecto | Meta Q1 |
|----------|---------|
| **Silhouette** | Lanzar v0.9 con 3 herramientas, 3 casos de uso |
| **Brandistry Playbook 2.0** | Cerrar contenido, validar con 1 cliente |
| **Libro Filos√≥fico** | 7 cap√≠tulos, 500-700 palabras diarias |
| **CFU Experiments** | 1 experimento reproducible/trimestre |
| **NWC Campaigns** | 5 campa√±as, 2 iteraciones creativas |

#### Sistema Operativo Personal
- **Diario:** Now/Next/Never, Deep Work (20-90 min), Ejercicio (30 min), Escritura (500-700 palabras), Decision Journal
- **Semanal:** Shipping ritual (Viernes 16:00), Premortem/Red Team, Kill-List (eliminar 1 actividad de bajo valor)

#### GitHub: haroldfabla2-hue
- Framework empresarial (46+ equipos, AI/ML)
- IRIS CODE (plataforma de desarrollo con fallback IA)
- Silhouette Workflow Platform
- IRIS Enterprise V5.0

#### Protocolo Anti-Alucinaciones (REQUERIDO)
**Estrategias obligatorias para Sil:**
1. **CoVe (Chain of Verification):** Verificar con comandos reales
2. **Grounding Externo:** Brave Search para info actual
3. **PRM:** Supervisar cada paso del razonamiento
4. **Sandboxing:** Docker para aislamiento
5. **Temperatura:** 0.2-0.3 (reducir aleatoriedad)

### Carpetas y Recursos
| Recurso | Enlace/Ubicaci√≥n |
|---------|-----------------|
| **Silhouette Folder** | https://drive.google.com/drive/folders/1KAL82md9CU67Fsns3rM7iiPZmJed1dkC |
| **Perfil Alberto** | Drive: "informacion de Alberto Farah" |
| **Anti-Hallucination** | Drive: "Pt titil√≥ de mitigaci√≥n de alucinaciones" |

---

## üìÖ 2026-02-05 - Resumen de Configuraci√≥n Proactiva

### APIs Configuradas
| API | Variable | Estado |
|-----|----------|--------|
| **OpenWeatherMap** | OPENWEATHERMAP_API_KEY | ‚úÖ 5ad3e25821e71bcc8cfd380415e7b457 |

### Cron Jobs Activos (Sistema Proactivo)
| Job | Schedule | Descripci√≥n |
|-----|----------|-------------|
| Weather Alert | 0 7 * * * | Alerta clima (7 AM) |
| Morning Email Summary | 0 8 * * * | Resumen emails (8 AM) |
| Calendar Reminder | */30 8-18 * * * | Reuniones (cada 30 min) |
| Server Health Check | 0 9 * * * | Health check (9 AM) |

### Scripts Proactivos
| Script | Ubicaci√≥n |
|--------|-----------|
| Health Check | ~/.openclaw/tools/sil-healthcheck.sh |
| Email Summary | ~/.openclaw/tools/sil-email-summary.sh |
| Weather Alert | ~/.openclaw/tools/sil-weather.sh |

---

## üîê Reglas de Privacidad (DE ALBERTO)

**NUNCA:**
- ‚ùå Hacer p√∫blica su informaci√≥n innecesariamente
- ‚ùå Acceder a cuentas personales sin permiso
- ‚ùå Compartir informaci√≥n privada

**SIEMPRE:**
- ‚úÖ Documentar accesos a recursos compartidos
- ‚úÖ Almacenar credenciales en .env
- ‚úÖ Respetar confidencialidad

---
